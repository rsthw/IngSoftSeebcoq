<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">
    <h:head>
        <title>Puesto</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </h:head>
    <h:body>
        <p:growl id="messages" showDetail="true" />
        
        <h:form id = "menu">
            <p:menubar>
                    <f:facet name="options">
                        <p:commandButton value="Mapa" 
                                         action="index.xhtml?faces-redirect=true" />
                    </f:facet>
                    <f:facet name="options" >
                        <h:outputText value="Bienvenido, "
                                      rendered="#{not empty iniciarSesionIH.valid}" />
                        <h:outputText value="#{iniciarSesionIH.usuario}"
                                      rendered="#{not empty iniciarSesionIH.valid}" />
                        <h:outputText value="   "
                                      rendered="#{not empty iniciarSesionIH.valid}" />
                        <p:commandButton value="Cerrar Sesión" 
                                         action="#{iniciarSesionIH.cerrarSesion}" 
                                         rendered="#{not empty iniciarSesionIH.valid}" 
                                         onclick = "$( #menu ).load( index.xhtml #menu );"/>
                    </f:facet>
                    <f:facet name="options">
                        <p:commandButton type="submit" 
                                         value="Crear Nuevo Usuario" 
                                         ajax = "false" 
                                         action="crearCuenta.xhtml?faces-redirect=true"
                                         rendered="#{empty iniciarSesionIH.valid}"/>
                        <p:commandButton type="submit" 
                                         value="Iniciar Sesión" 
                                         ajax = "false" 
                                         action="iniciarSesion.xhtml?faces-redirect=true"
                                         rendered="#{empty iniciarSesionIH.valid}"/>
                    </f:facet>
            </p:menubar>
         </h:form>
        <h:outputText value="#{puestoIH.nombre}" />
        <h:form id="comentarioInput">
            
            <h:panelGrid id="grid" columns="2" cellpadding="5">
                <p:inputTextarea maxlength="255" 
                                 autoResize="true" 
                                 id="comentario" 
                                 value="#{puestoIH.comentario}" 
                                 required="true" label="Comentario"/>
                <p:commandButton value="Enviar" 
                             id="botonEnviar"
                             action="#{puestoIH.guardarComentario}" 
                             icon="ui-icon-check" 
                             validateClient="true" 
                             onclick="$( #comentarios ).load( index.xhtml #comentarios);$( #comentario).load( index.xhtml #comentario );" 
                             disabled="#{empty iniciarSesionIH.valid}" />
            </h:panelGrid>
            
        </h:form>
        
        <h:form id="comentarios">
            <p:dataScroller value="#{puestoIH.comentarios}" var="com" chunkSize="10" >

                <f:facet name="loader">
                    <p:commandButton type="button" value="More" icon="ui-icon-circle-triangle-s"/>
                </f:facet>

                <h:panelGrid columns="2" style="width:100%" columnClasses="logo,detail">
                    <p:outputPanel>
                        <h:panelGrid columns="2" cellpadding="5">
                            <h:outputText value ="Usuario:"/>
                            <h:outputText value ="#{com.idPersona.nombreDeUsuario}"/>
                            <h:outputText value="Comentario:" />
                            <h:outputText value="#{com.comentario}" style="font-weight: bold"/>
                            <p:commandButton action="#{puestoIH.eliminarComentario(com)}" value="Eliminar" 
                                             rendered="#{iniciarSesionIH.valid eq 2}"
                                             onclick="$( #comentarios ).load( index.xhtml #comentarios);"/>
                        </h:panelGrid>
                    </p:outputPanel>
                </h:panelGrid>
            </p:dataScroller>
        </h:form>
    </h:body>
</html>
